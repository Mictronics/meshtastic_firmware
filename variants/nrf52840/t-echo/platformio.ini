; Using original screen class
[env:t-echo]
custom_meshtastic_hw_model = 7
custom_meshtastic_hw_model_slug = T_ECHO
custom_meshtastic_architecture = nrf52840
custom_meshtastic_actively_supported = true
custom_meshtastic_support_level = 1
custom_meshtastic_display_name = LILYGO T-Echo
custom_meshtastic_images = t-echo.svg
custom_meshtastic_tags = LilyGo

extends = nrf52840_base
board = t-echo
upload_protocol = jlink
# debug settings for external openocd
debug_tool = custom
debug_init_break = tbreak main
debug_init_cmds =
  target extended-remote localhost:3333
  $INIT_BREAK
  monitor reset halt
  $LOAD_CMDS
  monitor init
  monitor reset halt

# add -DCFG_SYSVIEW if you want to use the Segger systemview tool for OS profiling.
# Start openocd int terminal: openocd -c 'interface jlink; transport select swd; source [find target/nrf52.cfg]' -c 'init'
build_flags = ${nrf52840_base.build_flags} -Ivariants/nrf52840/t-echo
  -DGPS_POWER_TOGGLE
  -DEINK_DISPLAY_MODEL=GxEPD2_154_D67
  -DEINK_WIDTH=200
  -DEINK_HEIGHT=200
  -DUSE_EINK
  -DUSE_EINK_DYNAMICDISPLAY            ; Enable Dynamic EInk
  -DEINK_LIMIT_FASTREFRESH=20          ; How many consecutive fast-refreshes are permitted
  -DEINK_BACKGROUND_USES_FAST          ; (Optional) Use FAST refresh for both BACKGROUND and RESPONSIVE, until a limit is reached.
  -g

build_src_filter = ${nrf52_base.build_src_filter} +<../variants/nrf52840/t-echo>
lib_deps = 
  ${nrf52840_base.lib_deps}
  # renovate: datasource=git-refs depName=meshtastic-GxEPD2 packageName=https://github.com/meshtastic/GxEPD2 gitBranch=master
  https://github.com/meshtastic/GxEPD2/archive/a05c11c02862624266b61599b0d6ba93e33c6f24.zip
  # renovate: datasource=custom.pio depName=SensorLib packageName=lewisxhe/library/SensorLib
  lewisxhe/SensorLib@0.3.4
;upload_protocol = fs

#[env:t-echo-inkhud]
#extends = nrf52840_base, inkhud
#board = t-echo
#board_check = true
#debug_tool = jlink
#build_flags =
#  ${nrf52840_base.build_flags}
#  ${inkhud.build_flags}
#  -I variants/t-echo
#  -L "${platformio.libdeps_dir}/${this.__env__}/bsec2/src/cortex-m4/fpv4-sp-d16-hard"
#build_src_filter =
#  ${nrf52_base.build_src_filter}
#  ${inkhud.build_src_filter}
#  +<../variants/t-echo>
#lib_deps =
#  ${inkhud.lib_deps} ; InkHUD libs first, so we get GFXRoot intead of AdafruitGFX
#  ${nrf52840_base.lib_deps}
#  lewisxhe/PCF8563_Library@^1.0.1
